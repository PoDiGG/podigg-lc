'use strict';

const Podigg = require('podigg');
const childProcess = require('child_process');
const fs = require('fs');

// Generate GTFS
var generator = Podigg.fromEnvironmentVariables();
generator.generate('.');

function prefixZero(element) {
    return element < 10 ? "0" + element : element;
}

function timestampToDate(timestamp) {
    var date = new Date(timestamp);
    return date.getFullYear() + "" + prefixZero(date.getMonth() + 1) + "" + prefixZero(date.getDate() + 1);
}

// Convert GTFS to LC
var startDate = timestampToDate(generator.options['time_initial'] || 0);
var endDate = timestampToDate(generator.options['time_final'] || (24 * 3600000 * 31));
var p = childProcess.spawn('./node_modules/gtfs2lc/bin/gtfs2lc.js', ['./gtfs', '-f', 'turtle', '-r', '-s', startDate, ' -e', endDate]);
p.stdout.pipe(fs.createWriteStream('./lc.ttl'));
p.stderr.pipe(process.stderr);

